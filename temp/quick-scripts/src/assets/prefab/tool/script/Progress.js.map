{"version":3,"sources":["assets\\prefab\\tool\\script\\Progress.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Progress extends cc.Component {\r\n\r\n    @property(cc.Node)\r\n    rangNode: cc.Node = null;\r\n\r\n    rangMaxWidth = 190;               //进度条最大值\r\n    rangAddFrontWidth = 0;          //进度条前进前的宽度\r\n    rangUpdateWidth = 0;            //进度条需要前进到的宽度\r\n\r\n    tempAddWidth;\r\n\r\n    private progressName = \"proGressPlist\"\r\n    private startNodePos: cc.Vec2 = null;\r\n    \r\n    private total_pool = {}//对象池\r\n    private total_prefab = {}//特效粒子\r\n    private parent_node: cc.Node = null;\r\n\r\n    private targetWidth;\r\n\r\n    onLoad() {\r\n        //this.rangMaxWidth = this.rangNode.parent.width;     //设置进度条最大宽度值\r\n        this.parent_node = cc.director.getScene().getChildByName('Canvas');\r\n        this.initEffect();\r\n    }\r\n\r\n    onEnable() {\r\n        this.rangNode.width = 0;\r\n    }\r\n\r\n    setPercent(percent: number, startNode?: cc.Node) {        \r\n        if (startNode) {\r\n            this.startNodePos = startNode.parent.convertToWorldSpaceAR(startNode.getPosition());\r\n        }\r\n        else {\r\n            this.startNodePos = cc.director.getScene().getChildByName('Canvas').getPosition();\r\n        }\r\n        this.rangAddFrontWidth = this.rangNode.width;                 //没前进前的宽度\r\n        this.rangUpdateWidth = this.rangMaxWidth * percent;           //需要前进到的值               \r\n        if(this.rangNode.width == this.rangUpdateWidth){\r\n            this.rangUpdateWidth = 0;\r\n        }\r\n        else if(this.rangUpdateWidth >= this.rangMaxWidth){\r\n            this.rangUpdateWidth = this.rangMaxWidth;\r\n        }\r\n    }\r\n\r\n    setProgressImage(percent:number){\r\n        this.rangNode.width = this.rangMaxWidth * percent;\r\n    }\r\n\r\n    update() {\r\n        if (this.rangUpdateWidth) {\r\n            let range = this.rangUpdateWidth;\r\n            if (this.rangNode.width < range) {\r\n                this.rangNode.width += (range - this.rangAddFrontWidth) / 20;\r\n                if (this.rangNode.width >= range) {\r\n                    this.rangNode.width = range;\r\n                }\r\n            }\r\n            if (this.rangNode.width >= range) {\r\n                this.rangUpdateWidth = 0;\r\n            }\r\n\r\n            if (this.startNodePos) {\r\n                let cnt = 1;\r\n                for (let i = 0; i < cnt; i++) {\r\n                    let aaa = this.rangNode.parent.convertToWorldSpaceAR(cc.v2(this.rangNode.x, this.rangNode.y));\r\n                    const startWPos = this.parent_node.convertToNodeSpaceAR(this.startNodePos);\r\n                    const targetWPos = this.parent_node.convertToNodeSpaceAR(aaa);\r\n                    const moveOutDurationTime2 = 0.2 + Math.random() * 0.2;\r\n                    const moveToDurationTime = 0.2 + Math.random() * 0.3;\r\n                    this.createEffect(this.progressName, (node, script) => {\r\n                        node.setPosition(startWPos);\r\n                        const radiusTemp = 50 * Math.random() + 10;\r\n                        const radians = cc.misc.degreesToRadians(160 + 360 / cnt * i);\r\n                        const baseV2 = cc.v2(1, 0);\r\n                        const roateV3 = baseV2.rotate(radians).scaleSelf(cc.v2(radiusTemp, radiusTemp));\r\n                        const seq = cc.sequence(\r\n                            cc.moveTo(moveOutDurationTime2, startWPos.add(roateV3)),\r\n                            cc.moveTo(moveToDurationTime, targetWPos).easing(cc.easeOut(1.5)),\r\n                            cc.callFunc(() => {\r\n                                this.removeEffect(this.progressName, node)\r\n                            }),\r\n                        );\r\n\r\n                        node.runAction(seq);\r\n                    })\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    getCurWidth() {\r\n        return this.rangNode.width;\r\n    }\r\n\r\n    getMaxWidth() {\r\n        return this.rangMaxWidth;\r\n    }\r\n\r\n    initEffect() {\r\n        cc.loader.loadResDir(`Effect/${this.progressName}`, cc.Prefab, function (err, assets, urls) {\r\n            if (err) {\r\n                console.error(\"加载失败\")\r\n                return\r\n            }\r\n            if(this.total_prefab){\r\n                for (let m in assets) {\r\n                    if (assets[m]) {\r\n                        this.total_prefab[assets[m].name] = assets[m];\r\n                        this.total_pool[assets[m].name] = new cc.NodePool();\r\n                    }\r\n                }\r\n                console.log(this.total_prefab)\r\n            }\r\n        }.bind(this));\r\n    }\r\n\r\n    createEffect(name, succ, parent = this.parent_node) {//生成特效\r\n        if (this.total_prefab && this.total_prefab[name]) {\r\n            let node = null\r\n            if (this.total_pool[name].size() > 0) {\r\n                node = this.total_pool[name].get()\r\n                node.parent = parent;\r\n            } else {\r\n                node = cc.instantiate(this.total_prefab[name])\r\n                node.parent = parent;\r\n            }\r\n            if (node) {\r\n                let script = node.getComponent(name)\r\n                if (succ) succ(node, script)\r\n            }\r\n        }\r\n    }\r\n\r\n    removeEffect(name, node, isDestroy = false) {//移除特效\r\n        node.destroy()\r\n    }\r\n\r\n    findDefaultParent() {\r\n        return this.parent_node\r\n    }\r\n}\r\n"]}