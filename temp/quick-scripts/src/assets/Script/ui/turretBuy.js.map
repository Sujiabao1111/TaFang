{"version":3,"sources":["assets\\Script\\ui\\turretBuy.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import baseTs from \"../base/baseTs\";\nimport { AdPosition } from \"../common/AdPosition\";\nimport NameTs from \"../common/NameTs\";\nimport pageTs from \"../common/pageTs\";\nimport AdController from \"../server/xmsdk_cocos/AD/AdController\";\nimport soundController from \"../soundController\";\nimport TrackMgr from \"../TrackMgr/TrackMgr\";\nimport tool from \"../util/tool\";\nimport util from \"../util/util\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class turretBuy extends baseTs {\n\n    @property(cc.Node)\n    touchNode:cc.Node = null; //用于拖动位置的\n    \n    @property(cc.Node)\n    buyBtnNode:cc.Node = null; //购买按钮\n\n    @property({displayName:\"等级\",type:cc.Label})\n    levelLabel: cc.Label = null;\n    \n    \n    @property({displayName:\"视频炮塔\",type:cc.Label})\n    videoNum: cc.Label = null;\n    \n    @property({type:sp.Skeleton,displayName:\"炮\"})\n    paoBody: sp.Skeleton = null;\n\n    //接触时间\n    private touchTime:number = 0;\n    //是否在接触\n    private isTouch:boolean = false;\n\n    private level:number = null;\n\n    private turretData:any;\n\n    private turretNum:number = 0;\n\n    onLoad () {\n\n        this.setVideoNum();\n\n        let initPos:cc.Vec2  = this.node.getPosition();\n        this.node.on(cc.Node.EventType.TOUCH_START,()=>{\n            TrackMgr.AppClick({\n                app_page_title: \"首页\",\n                app_ck_module: \"炮塔\",\n                app_exposure_type: \"banner\",\n            })\n            this.touchTime = 0;\n            this.isTouch = true;\n            cc.tween(this.buyBtnNode).to(.1,{scale:1.1}).start();\n            cc.tween(this.node).to(.1,{scale:1.1}).start();\n        },this);\n        \n\n        \n        //预加载空降炮塔信息流\n        // if(!util.adPreObj[AdPosition.GetOtherTurretView]&&util.userData.product==5){\n        //     util.preloadAd(AdPosition.GetOtherTurretView,true);\n        // }\n\n        // if(util.userData.product==0&&!util.adPreObj[AdPosition.GetTurretView]){\n        //     util.preloadAd(AdPosition.GetTurretView,true);\n        // }\n\n        this.node.on(cc.Node.EventType.TOUCH_MOVE,(event)=>{\n            if(util.userData.noviceGuide==1||util.userData.product==0)return;\n            let movePos:cc.Vec2 = event.getDelta();\n            this.node.x +=movePos.x;\n            this.node.y +=movePos.y; \n\n        },this);\n\n        this.node.on(cc.Node.EventType.TOUCH_END,(event)=>{\n            soundController.singleton.clickAudio();\n            if(util.checkTestB(NameTs.new_hand_test)){\n                if(util.userData.noviceGuide==2){\n                    cc.game.emit(NameTs.Game_Turret_Creator);\n                    TrackMgr.rookie_process_2({\n                        activity_state:\"点击任意位置购买炮塔\"\n                    });\n                    cc.game.emit(NameTs.Game_Novice_Open,3);\n                    return;\n                }\n            }else if(util.userData.noviceGuide==1){\n                cc.game.emit(NameTs.Game_Turret_Creator);\n                cc.game.emit(NameTs.Game_Novice_Open,2);\n                return;\n            }\n            if(util.userData.product==5&&Math.random()<.5&&util.userData.airborneCount>0){\n                this.showPage(pageTs.pageName.GameGetOtherTurret,this.level);\n                return;\n            }else{\n                console.log(\"不出现天降炮塔!\")\n            }\n            \n            //预加载空降炮塔信息流\n            // if(!util.adPreObj[AdPosition.GetOtherTurretView]&&util.userData.product==6){\n            //     util.preloadAd(AdPosition.GetOtherTurretView,true);\n            // }\n\n            if(util.userData.product==1){\n                // if(!util.adPreObj[AdPosition.GetTurretView]){\n                //     util.preloadAd(AdPosition.GetTurretView,true);\n                // }\n                this.setVideoNum();\n            }\n\n            if(util.userData.product==0&&util.userData.GetTurretNum>0){\n                this.showPage(pageTs.pageName.GameGetVideoTurret,{num:this.turretNum});  \n                return;\n            }\n            if(this.touchTime<.3){                \n                cc.game.emit(NameTs.Game_Turret_Creator,{level:this.level});\n            }else{\n                let poolBox:cc.Node = this.touchNode;\n                let pos:cc.Vec2 = this.node.getParent().convertToWorldSpaceAR(this.node.getPosition());\n                pos = poolBox.convertToNodeSpaceAR(pos);\n                util.checkTouchPool(pos,(num)=>{\n                    if(num!==100&&num&&util.checkNoExist(num)){\n                        cc.game.emit(NameTs.Game_Turret_Creator,{level:this.level,location:num});\n                    }\n                });\n                \n            }\n            soundController.singleton.clickAudio();\n            this.node.setPosition(initPos);\n            cc.tween(this.buyBtnNode).to(.1,{scale:1}).start();\n            cc.tween(this.node).to(.1,{scale:1}).start();\n            TrackMgr.AppClick({\n                app_page_title: \"首页\",\n                app_ck_module: \"放置炮塔\",\n                app_exposure_type: \"banner\",\n            });\n        },this);\n\n        cc.game.on(NameTs.Game_Buy_update,()=>{\n\n            this.setLevel();\n\n        },this);\n\n        this.setLevel();\n    }\n\n    start () {\n\n    }\n    \n\n    /**\n     * 更新炮塔\n     */\n    setLevel(){\n        \n        this.level = util.getBuyRandomLevel();\n        this.levelLabel.string = String(this.level);\n\n        //炮塔属性\n        this.turretData = util.GetTurretData(this.level);\n\n        // this.loadSprite(\"body\",res=>{\n        //     this.paoBody.spriteFrame = res;\n        // });\n        // this.loadSprite(\"foot\",res=>{\n        //     this.paoFoot.spriteFrame = res;\n        // });\n\n        \n        this.loadSpine(this.paoBody,\"pao\");\n\n    }\n\n    update (dt) {\n\n        if(this.isTouch){\n            this.touchTime+=dt;\n        }\n\n    }\n\n    /**\n     * 设置视频炮塔数量\n     */\n    setVideoNum(){\n\n        this.turretNum = tool.GetRandom(8,12);\n\n        this.videoNum.string = \"+\"+this.turretNum;\n\n    }\n\n    /**\n     * 加载图片\n     */\n    // loadSprite(name:string,call:Function){\n    //     cc.resources.load(\"/texture/turret/\"+name+\"_\"+this.level,cc.SpriteFrame,(err,res:cc.SpriteFrame)=>{\n\n    //         if(err){\n    //             console.error(\"找不到该图片\",err);\n    //             return;\n    //         }\n    //         call(res);\n\n    //     });\n    // }\n\n    /**\n     * 加载图片\n     */\n    loadSpine(spine:sp.Skeleton,name:string){\n\n        //console.log(this.turretData,'name==========')\n\n        cc.resources.load(\"spine/turret/\"+this.turretData.DynamicResources+\"/\"+name+\"/\"+this.turretData.spineName,sp.SkeletonData, (error, sp:sp.SkeletonData) => {\n            spine.skeletonData = sp;\n            this.paoBody.node.y = Number(this.turretData.buyY);\n        });\n\n    }\n}\n"]}