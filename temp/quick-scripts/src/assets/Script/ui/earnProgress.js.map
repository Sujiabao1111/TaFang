{"version":3,"sources":["assets\\Script\\ui\\earnProgress.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { AssistCtr } from \"../Assist/AssistCtr\";\nimport baseTs from \"../base/baseTs\";\nimport NameTs from \"../common/NameTs\";\nimport pageTs from \"../common/pageTs\";\nimport { UrlConst } from \"../server/UrlConst\";\nimport soundController from \"../soundController\";\nimport TrackMgr from \"../TrackMgr/TrackMgr\";\nimport util from \"../util/util\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class earnProgress extends baseTs {\n\n    \n    @property(cc.ProgressBar)\n    taskProgress:cc.ProgressBar = null; //任务进度条\n    \n    @property(cc.Label)\n    tasklabel1:cc.Label = null; //任务标题\n\n    @property(cc.Label)\n    tasklabel2:cc.Label = null; //任务标题\n    \n    @property(cc.Label)\n    getTime:cc.Label = null; //可以领多少次\n    \n    @property(dragonBones.ArmatureDisplay)\n    hongbao:dragonBones.ArmatureDisplay = null; //红包\\\n    \n    @property(cc.Node)\n    hand: cc.Node = null; //手势\n\n    private coin:number = 500; //默认500\n\n    private initData:any = null;\n\n    private isRuning:boolean = false;//是否在东\n    private isHand:boolean = false;//是否在东\n\n    // private handArr:any[] = [{num:3000,isHand:false},{num:6000,isHand:false},{num:9000,isHand:false}];\n\n    private nowGear:number = null;//默认进度3000\n\n    private handNum:number = 3;//默认次数\n\n    private userCoin:number = null;\n\n    onLoad () {\n\n        // cc.game.on(NameTs.Game_Task_Progress, ()=>{\n        //     this.setState();\n        // });\n\n        this.handNum = util.getStorage(util.localDiary.earnProgress)\n        if(this.handNum == null){       \n            this.handNum = 3;     \n            util.setStorage(util.localDiary.earnProgress, 3);\n        } \n        \n\n        this.init();\n        \n\n        //监听金币进度\n        cc.game.on(NameTs.Game_EarnProgress_Updata,()=>{\n\n            if(!this.initData)return;\n\n            this.initData.canReceiveTimes -= 1;\n\n            this.setState(this.initData);\n            \n            this.checkFill();\n\n            if(this.handNum>0){\n                this.handNum -=1; \n                this.hand.active = true;\n                util.setStorage(util.localDiary.earnProgress, this.handNum);\n            }else{\n                this.hand.active = false;\n            }\n\n        },this);\n\n\n        //监听金币进度\n        cc.game.on(NameTs.Game_Wallet_AddCoin,(res)=>{\n            if(!this.initData)return;\n            if(res>0){\n                this.userCoin += res;\n                this.setState(this.initData);\n                this.checkFill();\n            }\n\n        },this);\n\n        \n        util.GlobalMap.set(\"earnProgress\",this.hongbao.node);\n\n    }\n\n    /**\n     * 检查是否满了\n     */\n    checkFill(){\n        if(this.userCoin>=this.initData.nextGear){\n            console.log(\"进度已满，重新请求\")\n            util.sendCoinData(()=>{\n                this.init();\n            });\n            \n            TrackMgr.luckybag_task({\n                activity_state: \"任务完成\",\n                task_level: String(this.initData.nextGear),\n            });\n        }\n    }\n\n    init(){\n\n        util.getdataStr({\n            url:UrlConst.earnProgressIndex,\n            success:data=>{\n                this.setState(data);\n            },\n            fail:(err)=>{\n                console.log(\"请求失败，暂时将这个关闭掉\");\n                this.node.active = false;\n            }\n        });\n\n    }\n\n    /**\n     * 展现任务\n     */\n    showGameEarn(){\n        TrackMgr.luckybag_task({\n            activity_state: \"任务点击\",\n            task_level: String(this.initData.nextGear),\n        });\n        if(this.initData.canReceiveTimes<=0){\n            AssistCtr.showToastTip(\"再赚取\"+(this.initData.nextGear-this.userCoin)+\"红包\");\n            return;\n        }\n\n\n        soundController.singleton.clickAudio();\n\n        this.showPage(pageTs.pageName.GameEarnPro,{coin:this.coin});\n\n        \n        this.isHand = false;\n        this.hand.active = false;\n        this.isRuning = false;\n        this.hongbao.playAnimation(\"shake\",1);\n    }\n\n    /**设置状态 */\n\n    setState(data){\n        \n        this.initData = data;\n\n        if(!this.initData||(this.initData&&!this.initData.reward)){\n            console.log(\"初始化数据不存在！隐藏该功能!\");\n            this.node.active = false;\n            return;\n        }\n\n        this.coin = this.initData.reward;\n\n        if(this.nowGear){\n\n            if(this.nowGear!==this.initData.nextGear){\n                this.nowGear = this.initData.nextGear;\n            }\n\n        }else{\n            this.nowGear = this.initData.nextGear;\n            \n        }\n        \n        if(!this.userCoin){\n            this.userCoin = this.initData.point;\n        }\n\n\n        this.tasklabel1.string = this.userCoin+\"\";\n        this.tasklabel2.string = \"/\"+this.initData.nextGear;\n        \n        this.taskProgress.progress = this.userCoin/this.initData.nextGear;\n\n        // if(this.hongbao)\n        \n        this.getTime.string = this.initData.canReceiveTimes;\n\n        this.getTime.node.parent.active = this.initData.canReceiveTimes>0;\n\n        // if(this.initData.canReceiveTimes>0){\n        //     this.playAni();\n        //     // this.hongbao.playAnimation(\"shake\",0);\n        // }else{\n        //     this.isRuning = false;\n        //     this.hongbao.playAnimation(\"shake\",1);\n        // }\n\n        // this.checkHand();\n\n        \n        this.hand.active = this.handNum>0&&this.initData.canReceiveTimes>0;\n\n        if(this.initData.canReceiveTimes>0){\n            this.hongbao.playAnimation(\"shake\",0);\n        }else{\n            this.isRuning = false;\n            this.hongbao.playAnimation(\"shake\",1);\n        }\n\n        \n\n    }\n\n    playAni(){\n        if(this.isRuning)return;\n        this.isRuning = true;\n        this.hongbao.playAnimation(\"shake\",0);\n        // cc.tween(this.hongbao).repeatForever(\n        //     cc.tween().parallel(\n        //         cc.tween().by(.1,{angle:-5}).by(.2,{angle:10}).by(.2,{angle:-10}).by(.1,{angle:5}).delay(.5),\n        //         cc.tween().to(.3,{scale:1.2}).to(.3,{scale:1}).delay(.5)\n        //     )\n        // ).start();\n\n    }\n\n    /**检查手势 */\n    checkHand(){\n        // if(this.isHand)return;\n        // if(this.nowGear==6000||this.nowGear==9000||this.nowGear==12000){\n        //     if(this.initData.canReceiveTimes>0){\n        //         this.isHand = true;\n        //         this.hand.active = true;\n        //     }else{\n        //         this.isHand = false;\n        //         this.hand.active = false;\n        //     }\n        // }\n    }\n    // update (dt) {}\n}\n"]}