{"version":3,"sources":["assets\\Script\\model\\BtnRandomRed.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { AssistCtr } from \"../Assist/AssistCtr\";\r\nimport NameTs from \"../common/NameTs\";\r\nimport pageTs from \"../common/pageTs\";\r\nimport { UrlConst } from \"../server/UrlConst\";\r\nimport XMSDK from \"../server/xmsdk_cocos/XMSDK\";\r\nimport TrackMgr from \"../TrackMgr/TrackMgr\";\r\nimport util from \"../util/util\";\r\n\r\nexport interface randomRedData {\r\n    remainNum: number,                 //剩余次数    \r\n}\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class BtnRandomRed extends cc.Component {\r\n\r\n    @property(cc.Label)\r\n    lable_time: cc.Label = null;\r\n\r\n    @property(cc.Node)\r\n    img_closeRed: cc.Node = null;\r\n\r\n    @property(dragonBones.ArmatureDisplay)\r\n    img_openRed: dragonBones.ArmatureDisplay = null;    \r\n\r\n    onceEnter = true;\r\n\r\n    onEnable() {                \r\n        let self = this;\r\n        if(!util.chekcToday()){                        \r\n            util.setStorage(util.localDiary.randomRedTimeNum, 60);\r\n        }\r\n\r\n        let randomRedTimeNum = util.getStorage(util.localDiary.randomRedTimeNum)\r\n        if(randomRedTimeNum == null){            \r\n            util.setStorage(util.localDiary.randomRedTimeNum, 60);\r\n        } \r\n\r\n        util.randomRedTimeNum = randomRedTimeNum;\r\n        self.lable_time.string = AssistCtr.formatSeconds(util.randomRedTimeNum);\r\n        self.updateData();\r\n        \r\n        util.GlobalMap.set(\"RandomRed\",this.node);\r\n    }\r\n\r\n    onLoad() {\r\n        cc.game.on(NameTs.randomRedUpdate, this.updateData, this);\r\n        \r\n    }\r\n\r\n    clickOpen() {\r\n        let self = this;\r\n        TrackMgr.AppClick({\r\n            app_page_title: \"首页\",\r\n            app_ck_module: \"福利红包\",\r\n            app_exposure_type: \"icon\",\r\n        });\r\n\r\n\r\n        if (self.lable_time.node.active) {\r\n            AssistCtr.showToastTip(`${util.randomRedTimeNum}s后可领取`);\r\n        }\r\n        else {\r\n            cc.game.emit(NameTs.Game_Pop_Open, {name:pageTs.pageName.GameRandomRedPrize});\r\n        }\r\n\r\n        TrackMgr.welfare_red_envelope({\r\n            activity_state: \"点击福利红包\"\r\n        })\r\n    }\r\n\r\n    openTimer() {\r\n        let self = this;\r\n        if (util.randomRedTimeNum > 0) {\r\n            self.lable_time.string = AssistCtr.formatSeconds(util.randomRedTimeNum);\r\n            self.lable_time.node.active = true;\r\n            self.img_closeRed.active = true;\r\n            self.img_openRed.node.active = false\r\n\r\n            self.schedule(self.timerFun, 1)\r\n        }\r\n        else {\r\n            self.lable_time.node.active = false;\r\n            self.img_closeRed.active = false;\r\n            self.img_openRed.node.active = true;\r\n            self.img_openRed.playAnimation(\"fulihongbao\", 0);\r\n\r\n            TrackMgr.welfare_red_envelope({\r\n                activity_state: \"福利红包待领取\"\r\n            })\r\n        }\r\n    }\r\n\r\n    timerFun() {\r\n        let self = this;\r\n        if (util.randomRedTimeNum > 0) {\r\n            self.lable_time.string = AssistCtr.formatSeconds(util.randomRedTimeNum);\r\n        }\r\n        else {\r\n            self.unschedule(self.timerFun);\r\n            self.lable_time.node.active = false;\r\n            self.img_closeRed.active = false;\r\n            self.img_openRed.node.active = true;\r\n            self.img_openRed.playAnimation(\"fulihongbao\", 0);\r\n\r\n            util.randomRedTimeNum = 0;\r\n            TrackMgr.welfare_red_envelope({\r\n                activity_state: \"福利红包待领取\"\r\n            })\r\n        }\r\n        util.randomRedTimeNum--;\r\n    }\r\n\r\n    updateData() {\r\n        let self = this;\r\n        XMSDK.getdataStr({\r\n            url: UrlConst.btnRandomRedCount,\r\n            onSuccess: res => {\r\n                if (res.code === 0 && res.data) {\r\n                    if(!this.isValid){\r\n                        return;\r\n                    }\r\n\r\n                    if (res.data.remainingTimes > 0) {\r\n                        if (res.data.remainingTimes == 99) {\r\n                            self.lable_time.node.active = false;\r\n                            self.img_closeRed.active = false;\r\n                            self.img_openRed.node.active = true;\r\n                            self.img_openRed.playAnimation(\"fulihongbao\", 0);\r\n\r\n                            TrackMgr.welfare_red_envelope({\r\n                                activity_state: \"福利红包待领取\"\r\n                            })\r\n                        }\r\n                        else {\r\n                            if(!self.onceEnter){\r\n                                util.randomRedTimeNum = 60;\r\n                            }                            \r\n                            this.onceEnter = false;\r\n                            this.openTimer();\r\n                        }\r\n                    }\r\n                    else {\r\n                        this.node.active = false;\r\n                    }\r\n                } else {\r\n                    XMSDK.toast(res.message || '网络出错~', 2.5, 1);\r\n                }\r\n            },\r\n            onFail: res => {\r\n\r\n            }\r\n        })\r\n    }\r\n\r\n}\r\n"]}