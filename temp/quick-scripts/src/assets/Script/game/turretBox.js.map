{"version":3,"sources":["assets\\Script\\game\\turretBox.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { AssistCtr } from \"../Assist/AssistCtr\";\nimport baseTs from \"../base/baseTs\";\nimport { AdPosition } from \"../common/AdPosition\";\nimport { gameState, propType } from \"../common/faceTs\";\nimport NameTs from \"../common/NameTs\";\nimport pool from \"../common/pool\";\nimport TrackMgr from \"../TrackMgr/TrackMgr\";\nimport util from \"../util/util\";\nimport turret from \"./turret/turret\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class turretBox extends baseTs {\n\n    private turretPool:pool; //对象池\n\n    @property({displayName:\"炮塔\",type:cc.Prefab})\n    private turretPre:cc.Prefab = null;\n\n    private isOpenAuto:boolean = false;//是否启动\n    \n    //合成时间\n    private autoTime:number = 1;\n    //是否拿起\n    private isTouch:boolean = false;\n\n    onLoad(){\n\n        //监听创建\n        cc.game.on(NameTs.Game_Turret_Creator,res=>{\n            \n            this.createTurret(res);\n\n        },this);\n\n        \n\n        //监听销毁\n        cc.game.on(NameTs.Game_Turret_Killed,res=>{\n            if(res.node){\n                res.node.destroy();\n                res.node.removeFromParent();\n                res.node = null;\n            }\n            if(res.no||res.no===undefined){\n                cc.game.emit(\"turret_bg_\"+res.no);\n                cc.game.emit(\"turret_label_\"+res.no);\n            }\n            // this.turretPool.onEnemyKilled(res);\n\n        },this);\n\n        //监听自动合成\n        cc.game.on(NameTs.Tool_Effect_Name.Game_Prop_Atuo,()=>{\n            this.isOpenAuto = true;\n        },this);\n\n        //拿起\n        cc.game.on(NameTs.Game_Turret_PickUp,(res)=>{\n            \n            this.isTouch = true;\n\n        },this);\n\n        //放下\n        cc.game.on(NameTs.Game_Turret_PutDown,(res)=>{\n\n            this.isTouch = false;\n\n        },this);\n\n        //点击了空地宝箱\n        cc.game.on(NameTs.Click_Empty_Box,(no)=>{\n\n            this.createTurret({level:null, location:no, isFree:true}, true);\n\n        },this);        \n\n        \n        // this.loadAny(\"prefab/turret/turret\",cc.Prefab,(res)=>{            \n            // this.turretPool = new pool(res,16);\n            // console.log(this.turretPool,'turretPool')\n            \n        // });\n\n        this.initTurret();\n\n    }\n\n    /**\n     * 还原用户炮塔\n     */\n    initTurret(){\n        if(util && util.userData && util.userData.pool){\n            util.userData.pool.forEach(item=>{\n                if(item.level>0){\n                    this.createTurret({level:item.level,location:item.no,isFree:true});\n                }\n            });\n        }\n\n\n        //预加载解锁炮塔信息流\n        // if(!util.adPreObj[AdPosition.UnlcokTurretView]&&util.chekPoolHaveTwo()){\n        //     util.preloadAd(AdPosition.UnlcokTurretView,true);\n        // }\n\n        // for(let i = 1;i<6;i++){\n        //     this.createTurret({level:i+16,location:i,isFree:true});\n        // }\n\n        // this.createTurret({level:7,location:13,isFree:true});\n        // this.createTurret({level:20,location:14,isFree:true});\n        // this.createTurret({level:19,location:4,isFree:true});\n        // this.createTurret({level:19,location:5,isFree:true});\n        // this.createTurret({level:19,location:6,isFree:true});\n        // this.createTurret({level:19,location:7,isFree:true});\n        // this.createTurret({level:19,location:8,isFree:true});\n    }\n\n    /**\n     * 创建炮塔\n     * @param level 等级\n     * @param location 位置\n     */\n    createTurret(data:{level:number,location:number,isFree:boolean}={level:null,location:null,isFree:false}, isClickEmptyBox = false){\n        let level:number = data.level;\n        let location:number = data.location;\n        \n        if(util.userData.product<=0&&!data.isFree){\n            AssistCtr.showToastTip(\"不够能量\");\n            return;\n        }\n\n\n        let loaction = location||util.checkPool(); //看看是哪个\n\n        if(loaction==null){\n            AssistCtr.showToastTip(\"没有空地了，先把炮塔合成或回收吧！\");\n            return;\n        }\n\n        //如果有就直接等级没有就随机\n        level = level||util.getBuyRandomLevel();\n        if(!data.isFree)util.addProduct(-1);\n        util.userData.buyCount+=1;\n        util.savePool(loaction,level);\n        if(!data.isFree)cc.game.emit(NameTs.Game_Buy_update);\n        let item:cc.Node = cc.instantiate(this.turretPre);\n        item.getComponent(item.name).init({level:level,no:loaction});\n        item.setParent(this.node);\n\n        // this.turretPool.createEnemy(this.node,{level:level,no:loaction});      \n        \n        if(isClickEmptyBox){\n            item.scale = 0.6;\n            cc.tween(item).to(0.08, {scale: 1.1}).to(0.04, {scale: 1}).start();            \n\n            TrackMgr.empty_treasure({\n                activity_state:`宝箱点击`,\n                turret_level: level,\n                pun_number:`第${util.userData.customs.big}-${util.userData.customs.small}关`               \n            })\n\n            TrackMgr.AppBuyProductDialog_hcdg({\n                dialog_name_hcdg: `空降宝箱（已砸开）`\n            })\n        }\n    }\n\n\n    /**开启自动合成 */\n    openAuto(){\n        \n        if(!util.userData.prop[propType.auto-1].use){\n            this.unscheduleAllCallbacks();\n            return;\n        }\n        let arr = util.GetTurretAuto();\n        if(!arr)return;\n        let node1:cc.Node = util.GlobalMap.get(\"turret_\"+arr[0].no);\n        if(!node1)return;\n        let node2:cc.Node = util.GlobalMap.get(\"turret_\"+arr[1].no);\n        if(!node2)return;\n        let node2Pos:cc.Vec2 = cc.v2();\n        if(node2.getPosition){\n            node2Pos = node2.getPosition();\n        }\n        node1.zIndex = 99;\n\n        cc.tween(node1).to(.2,{x:node2Pos.x,y:node2Pos.y}).call(()=>{\n            node1.getComponent(turret).GetType(arr[1].no);\n        }).start();\n\n    }\n\n    update (dt) {\n\n        if(this.isOpenAuto&&!this.isTouch&&util.levelState==gameState.start){\n            this.autoTime-=dt;\n            if(this.autoTime<0){\n                this.autoTime = 1.5;\n                this.openAuto();\n            }\n        }\n\n    }\n\n    \n}\n"]}