{"version":3,"sources":["assets\\Script\\game\\monsterFactory.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { gamePass, gameState, monsterInfo, propState, propType, thingType } from \"../common/faceTs\";\nimport NameTs from \"../common/NameTs\";\nimport soundController from \"../soundController\";\nimport tool from \"../util/tool\";\nimport util from \"../util/util\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class monsterFactory extends cc.Component {\n\n \n    /**初始数据 */\n    initData:monsterInfo;\n\n    /**出生在哪里 */\n    initPos:cc.Vec2;\n\n    /**当前行走第几个数组(默认为0)*/\n    walkNo:number;\n    /**当前行走轨迹*/\n    walkArr:any[];\n    \n    /**怪物的id */\n    id:number;\n    \n    /**怪兽血量 */\n    monsterHp:number;\n\n    /**是否进行中冰冻 */\n    isFrozen:boolean = false;\n    \n    /**是否进行中保护 */\n    isShield:boolean = false;\n\n    /**怪兽图片 */\n    monsterSpine:dragonBones.ArmatureDisplay;\n\n    /**mapName */\n    monsetrName:string ;\n\n    /**颜色等级 */\n    colorLevel:number;\n\n    /**怪兽数据 */\n    monsterData:any;\n\n    onLoad(){\n\n        cc.game.on(NameTs.Game_End,()=>{\n\n            this.stopWalk();\n\n        },this);\n\n        \n\n        //监听游戏暂停\n        cc.game.on(NameTs.Game_Stop,()=>{\n            \n            this.stopWalk();\n\n        },this);\n\n        //监听游戏继续\n        cc.game.on(NameTs.Game_Resume,()=>{\n            \n            this.resumeWalk();\n\n        },this);\n\n        //清屏道具\n        cc.game.on(NameTs.Tool_Effect_Name.Game_Prop_Cls,(res)=>{\n            if(this.walkNo>0){\n                this.clearMonster();\n            }\n        },this);\n        //普通消除，不会有金币\n        cc.game.on(NameTs.Game_Monster_clearAll,(res)=>{\n            this.clearMonster2();\n        },this);\n    }\n\n\n    /**行走 */\n    walk(){\n        if(this.walkNo>=this.walkArr.length-1){\n            if(this.isShield)return;\n            this.GameEnd();\n            console.log(\"走到总店了\")\n            return\n        }\n        this.walkNo++;\n        this.node.zIndex = this.walkNo;\n        //设置当前\n        util.setLevelMonsterData(this.id,this.walkArr.length-1-this.walkNo);\n        let nextPos:cc.Vec2 = util.GetMapPos(this.walkArr[this.walkNo].y,this.walkArr[this.walkNo].x);\n        cc.tween(this.node).to(Number(this.initData.speed)/77,{x:nextPos.x,y:nextPos.y}).call(()=>{\n            this.walk();\n        }).start();\n    }\n\n    /**\n     * 结束游戏\n     */\n    GameEnd(){\n\n        util.sendTurretData();\n        util.levelState = gameState.end;\n        cc.game.emit(NameTs.Game_End,gamePass.fail);\n\n    }\n    \n    /**\n     * 怪兽受伤\n     * @param atk 扣多少血\n     * @param citr 暴击\n     */\n\n    monsterBruise(atk:number,crit:number=1){\n        // if(this.)\n        //暴击\n        atk *= crit;\n        //增能\n        let energizedNum:number = util.userData.prop[propType.energized-1].use?1:0;\n        //电击\n        let shockNum:number = util.userData.prop[propType.shock-1].use?.2:0;\n        //伤害\n        let hurtNum:number  = Math.floor(Number(atk)*(1+shockNum+energizedNum));\n        //扣血\n        this.monsterHp -= hurtNum;\n\n\n        //伤害值\n        if(crit==1){\n            cc.game.emit(NameTs.Game_Hurt_Creator,{value:hurtNum,pos:this.node.getPosition()});\n        }else{\n            cc.game.emit(NameTs.Game_Hurt_Crit_Creator,{value:hurtNum*crit,pos:this.node.getPosition()});\n        }\n\n        this.setHp(this.monsterHp/this.initData.hp);\n\n        if(this.monsterHp<=0){\n            this.clearMonster();\n            soundController.singleton.playDeadAudio();\n            return;\n        }\n    }\n\n    /**设置血量 */\n    setHp(num){\n        cc.game.emit(NameTs.Game_Monster_Hp_Linster+this.monsetrName,num);\n    }\n\n    update(dt){\n\n        if(util.levelState!==gameState.start)return;\n        if(util.userData.prop[propType.frozen-1].use==propState.start&&this.walkNo>0&&!this.isFrozen){\n            this.isFrozen = true;\n            this.openFrozen();\n            this.stopWalk();\n        }else if(util.userData.prop[propType.frozen-1].use == propState.end&&this.isFrozen){\n            this.closeFrozen();\n            this.resumeWalk();\n        }\n        if(util.userData.prop[propType.shield-1].use==propState.start&&!this.isShield){\n            this.isShield = true;\n        }else if(util.userData.prop[propType.shield-1].use==propState.end&&this.isShield){\n            this.isShield = false;\n            \n        }\n    }\n\n\n    /**暂停走 */\n    stopWalk(){\n        this.node.pauseAllActions();\n        this.monsterSpine.node.pauseAllActions();\n    }\n\n    /**继续走 */\n    resumeWalk(){\n        this.isFrozen = false;\n        this.monsterSpine.node.resumeAllActions();\n        this.node.resumeAllActions();\n    }\n\n    /**\n     * 开启冰冻\n     */\n    openFrozen(){\n    }\n\n    /**\n     * 关闭冰冻\n     */\n    closeFrozen(){\n    }\n\n    /**\n     * 清理怪兽\n     */\n    clearMonster(){\n        util.MonsterMap.delete(this.monsetrName);\n        this.node.stopAllActions();\n        util.delectLevelMonster(this.id);\n        let Earn:number = 1;\n        if(util.doubleEarn.use){\n            Earn = 2;\n        }\n        let pos:cc.Vec2 = this.node.getPosition();\n        let coin:number = util.GetBehaviorRewardVo(2);\n        let color:cc.Color = util.GetMonsterColor(this.colorLevel);\n        cc.game.off(NameTs.Game_Monster_Bruise+this.monsetrName);\n        cc.game.emit(NameTs.Game_Monster_Killed,{id:this.id,node:this.node,coin:coin*Earn});\n        cc.game.emit(NameTs.Game_Monster_Shadow_Linster+this.monsetrName);\n        cc.game.emit(NameTs.Game_Monster_Hp_Linster+this.monsetrName,0);\n        cc.game.emit(NameTs.Game_Monster_Blood_Creater,{pos,color});\n    }\n\n    /**\n     * 普通清除\n     */\n    clearMonster2(){\n        util.MonsterMap.delete(this.monsetrName);\n        this.node.stopAllActions();\n        util.delectLevelMonster(this.id);\n        cc.game.off(NameTs.Game_Monster_Bruise+this.monsetrName);\n        cc.game.emit(NameTs.Game_Monster_Killed,{id:this.id,node:this.node,coin:0});\n        cc.game.emit(NameTs.Game_Monster_Shadow_Linster+this.monsetrName);\n        cc.game.emit(NameTs.Game_Monster_Hp_Linster+this.monsetrName,0);\n    }\n\n    /**\n     * 加载图片\n     */\n    loadSpine(){\n        \n        // cc.resources.load(\"/texture/monster/monster\"+Number(level),cc.SpriteFrame,(err,res:cc.SpriteFrame)=>{\n\n        //     if(err){\n        //         console.error(\"找不到该图片\",err);\n        //         return;\n        //     }\n\n        // });\n        // let monsterData = util.GetMonsterData(level);\n        // console.log(monsterData,'monsterData')\n        this.monsterSpine.armatureName = this.monsterData.armature;\n        this.monsterSpine.animationName = this.monsterData.animation;\n        this.monsterSpine.playTimes = 0;\n\n\n    }\n\n    /**\n     * 死亡动画\n     * @param call 回调\n     */\n    dieAni(call:Function){}\n}\n"]}