{"version":3,"sources":["assets\\Script\\game\\turret\\turret.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { bulletInfo, gameState } from \"../../common/faceTs\";\nimport NameTs from \"../../common/NameTs\";\nimport pageTs from \"../../common/pageTs\";\nimport TrackMgr from \"../../TrackMgr/TrackMgr\";\nimport tool from \"../../util/tool\";\nimport util from \"../../util/util\";\nimport turretFactiory from \"../turretFactory\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class turret extends turretFactiory {\n\n    // @property(cc.Label)\n    // label: cc.Label = null;\n\n    @property({ type: sp.Skeleton, displayName: \"炮\" })\n    paoBody: sp.Skeleton = null;\n\n    @property({ type: sp.Skeleton, displayName: \"口\" })\n    paoFoot: sp.Skeleton = null;\n\n    // @property({type:cc.Sprite,displayName:\"炮身\"})\n    // paoBody: cc.Sprite = null;\n\n    // @property({type:cc.Sprite,displayName:\"泡脚\"})\n    // paoFoot: cc.Sprite = null;\n\n    @property(cc.Node)\n    pao: cc.Node = null;\n\n    initData;//初始化数据\n\n    private isAngle:boolean = false;//是否在旋转中\n\n    start() {\n\n    }\n\n\n\n    /**\n     * 攻击\n     * @param id 子弹\n     */\n    attackFn() {\n        // this.pao.stopAllActions();\n        // this.pao.scale = 0.4;\n\n        //没有目标 停止动画\n\n        // if(this.bullet.targetId==null||util.levelState==gameState.stop||util.levelState==gameState.end){\n        //     this.stopAttack();\n        //     return;\n        // }\n\n\n        // cc.tween(this.pao).call(()=>{\n        //     cc.game.emit(NameTs.Game_Turret_Bullet_Creator,this.bullet);\n        // }).delay(1/atkTime).call(()=>{\n        //     this.attackFn();\n        // }).start();\n        let atkTime: number = this.turretData.speed;\n        if (!atkTime) {\n            atkTime = 2;\n        }\n\n        let nodeParent:cc.Node = this.node.getParent();\n        this.unscheduleAllCallbacks();\n        this.schedule(() => {\n            if (util.levelState == gameState.stop || util.levelState == gameState.end) return;\n            if (this.bullet.targetId == null) {\n                this.attackData = null;\n                return;\n            }\n            this.isAngle = false;\n            this.setPao(()=>{\n                let bulletPos:cc.Vec2 = cc.Vec2.clone(this.paoFoot.node.getPosition());\n\n                if(Number(this.turretData.bulletY)>0){\n                    bulletPos.y +=Number(this.turretData.bulletY);\n                }\n                // if(this.initData.level==16||this.initData.level==38){\n                //     bulletPos.y +=30;\n                // }else if(this.initData.level==18||this.initData.level==29||this.initData.level==31||this.initData.level==21){\n                //     bulletPos.y +=50;\n                // }\n                bulletPos = this.paoBody.node.convertToWorldSpaceAR(bulletPos);\n                bulletPos = nodeParent.convertToNodeSpaceAR(bulletPos);\n                this.bullet.initPos = this.node.getPosition();\n                // this.paoBody.clearTracks();\n                if(this.initData.level!==37){\n                    this.paoBody.setAnimation(0, \"animation\", false);\n                }\n                if(this.turretData.mouth){\n                    // this.paoFoot.clearTracks();\n                    this.paoFoot.setAnimation(0, \"animation\", false);\n                }\n                cc.game.emit(NameTs.Game_Turret_Bullet_Creator, {data:this.bullet,pos:bulletPos});\n            });\n            \n        }, 1 / atkTime);\n\n\n\n    }\n\n    init(data) {\n\n        this.initData = data;\n        this.initData.level = Number(this.initData.level);\n        if(data.no){\n            let pos: cc.Vec2 = cc.Vec2.clone(util.GetPlaceData(data.no).pos);\n            this.node.setPosition(pos);\n        }\n        this.setName();\n        util.GlobalMap.set(\"turret_\" + data.no, this.node);\n        this.attackData = null;\n    }\n\n    /**\n     * 设置属性\n     */\n    setName() {\n        this.node.zIndex = 0;\n        // this.label.string = this.initData.level;\n        this.pao.angle = 0;\n        //炮塔属性\n        this.turretData = util.GetTurretData(this.initData.level);\n        this.paoFoot.node.active = this.turretData.mouth?true:false;\n\n        // if(this.turretData.level==5||this.initData.level==9||this.initData.level==11||this.initData.level==17||this.initData.level==22||this.initData.level==34){\n        //     this.paoFoot.node.y = 0;\n        // }else if(this.turretData.level==24||this.turretData.level==25||this.turretData.level==26||this.turretData.level==35){\n        //     this.paoFoot.node.y = 80;\n        // }else{\n        //     this.paoFoot.node.y = 52;\n        // }\n        this.paoFoot.node.y = Number(this.turretData.mouthY);\n        this.bullet = {\n            type: this.turretData.bulletType || 1,\n            targetId: null,\n            initPos: cc.Vec2.clone(this.node.position),\n            atk: Math.floor(this.turretData.atk),\n            speed: 1000,\n            crit:this.turretData.crit||15 //默认15几率\n        }\n\n        this.loadSpine(this.paoBody, \"pao\");\n\n        this.loadSpine(this.paoFoot, \"mouth\");\n\n        // cc.game.emit(NameTs.Game_Turret_Killed,{no:this.initData.no});\n        //销毁等级牌和文字\n        setTimeout(() => {\n            this.createLevelBg(this.initData.no,this.initData.level);\n        }, 100);\n\n    }\n\n    /**\n     * 升级\n     * @param no 哪个位置\n     */\n    upLevel(no?: number) {\n        this.initData.level += 1;\n        if(no){\n            this.initData.no = no;\n        }\n        if (util.upLevel(this.initData.level)&&this.initData.no) {\n            cc.game.emit(NameTs.Game_Pop_Open, pageTs.pageName.GameUpgrade);\n            if (util.userData.noviceGuide == 2) {\n                \n                if(util.checkTestB(NameTs.new_hand_test)){\n                    TrackMgr.rookie_process_2({\n                        activity_state:\"拖拽合成成功\"\n                    });\n                }else{\n                    TrackMgr.rookie_process({\n                        activity_state :\"拖拽合成效果页\",\n                        click_event: \"点击\"\n                    });\n                    cc.game.emit(NameTs.Game_Novice_Close);\n                }\n                \n            }\n\n            // cc.game.emit(NameTs.Game_Treasure_create);\n        }\n        else if(util.userData.turretLevel >= 7 && this.initData.no){\n            if(util.upTurretRandomRedTime){\n                let curTimer = new Date().getTime();\n                let padTime = curTimer - util.upTurretRandomRedTime;                \n                if(padTime >= 60000){\n                    util.upTurretRandomRedTime = curTimer;\n                    cc.game.emit(NameTs.Game_Pop_Open, pageTs.pageName.GameTurretRandomRed);\n                }\n                else if(padTime >= 30000){\n                    let randomNum = Math.random();                    \n                    if(randomNum <= 0.2){\n                        util.upTurretRandomRedTime = curTimer;\n                        cc.game.emit(NameTs.Game_Pop_Open, pageTs.pageName.GameTurretRandomRed);\n                    }\n                }\n            }\n            else{\n                util.upTurretRandomRedTime = new Date().getTime();\n                cc.game.emit(NameTs.Game_Pop_Open, pageTs.pageName.GameTurretRandomRed);\n            }            \n        }\n\n\n        if(this.initData.no){\n            util.savePool(no, this.initData.level);\n            util.buyCount = 0; \n        }else if(this.initData.no === undefined){\n            cc.game.emit(NameTs.Game_Turret_Killed,{no:undefined});\n        }\n        this.setName();\n        this.attackData = this.bullet.targetId = null;       \n    }\n\n    /**\n     * 设置炮塔角度\n     * @param call 回调 \n     */\n    setPao(call?:Function) {\n\n        if(this.turretData.rotation==1){\n            if(this.isAngle)return;\n            let lastAngle:number = this.pao.angle;\n            let nowAngle:number = this.GetAngle();\n            this.isAngle = true;\n            let angleNum:number = Math.abs(lastAngle-nowAngle);\n            if((nowAngle>-260&&nowAngle<=-270)){\n                nowAngle += 360;\n                this.pao.angle = nowAngle;\n                angleNum = 10;\n            }\n            else if(nowAngle>0&&nowAngle<=90){\n                nowAngle -= 360;\n                angleNum = 10;\n            }\n            if(angleNum>5&&angleNum<360){\n                cc.tween(this.pao).to(angleNum/1000,{angle:nowAngle}).call(()=>{\n                    this.isAngle = false;\n                    call&&call();\n                }).start();\n            }else{\n                this.pao.angle = nowAngle;\n                this.isAngle = false;\n                call&&call();\n            }\n        }else{\n            call&&call();\n        }\n\n        \n\n    }\n\n    /**停止攻击 */\n\n    stopAttack() {\n\n        // this.paoBody.stop();\n        // this.paoFoot.setAnimation(1,\"\",false);\n        this.pao.stopAllActions();\n        // this.pao.scale = 0.4;\n    }\n\n    /**继续攻击 */\n    resumeAttack() {\n        this.attackFn();\n    }\n\n}\n"]}