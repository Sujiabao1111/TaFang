{"version":3,"sources":["assets\\Script\\game\\treasureBox.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import baseTs from \"../base/baseTs\";\nimport jsonSingleton from \"../base/jsonSingleton\";\nimport { gameState } from \"../common/faceTs\";\nimport NameTs from \"../common/NameTs\";\nimport pageTs from \"../common/pageTs\";\nimport { UrlConst } from \"../server/UrlConst\";\nimport XMSDK from \"../server/xmsdk_cocos/XMSDK\";\nimport soundController from \"../soundController\";\nimport TrackMgr from \"../TrackMgr/TrackMgr\";\nimport util from \"../util/util\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class treasureBox extends baseTs {\n\n    @property({ type: cc.Node, displayName: \"宝箱\" })\n    private treasure: cc.Node = null;\n\n    // LIFE-CYCLE CALLBACKS:\n\n    //当前宝箱id\n    private nowId: number = null;\n\n    //宝箱时间\n    private time:number = null;\n\n    //金币\n    private coin:number = 0;\n\n    //剩余次数\n    private treasureNum:number = 20;\n\n    onLoad() {\n\n        cc.game.on(NameTs.Game_Treasure_StartTime, () => {\n\n            this.treasureNum -=1;\n\n            this.treasure.active = false;\n\n            this.time = 180;\n\n        }, this);\n//fix bug\n\n        util.getdataStr({\n            url:UrlConst.treasureBox_residual,\n            success:res=>{\n                if(!this.isValid){\n                    return;\n                }\n\n                this.treasureNum = res.times;\n                console.log(util.userData.noviceGuide,'util.userData.noviceGuide')\n                if(util.userData.noviceGuide==-1){\n                    this.time = 0;\n                }\n                // if(this.treasureNum>0&&this.time==0){\n                //     this.flyAni();\n                // }\n            }\n        });\n\n        cc.game.on(NameTs.Game_Treasure_Show,()=>{\n\n            this.time = 0;\n\n        },this);\n\n    }\n\n    start() {\n\n    }\n\n    /**\n     * 起飞\n     */\n    flyAni() {\n        // XMSDK.post({\n            // url: UrlConst.treasureBox_Isget,\n        //     onSuccess: res => {\n        //         if (res.code === 0 && res.data && res.data.showBox != 1) {       //领取过\n        //             return null;\n        //         }\n        //         else {\n        //             let data = jsonSingleton.singleton.getJson(NameTs.treasureData);\n        //             let treasureId: number = null;\n        //             for (let i = 0; i < data.length; i++) {\n        //                 let item = data[i];\n        //                 if (item.min <= util.userData.turretLevel && item.max > util.userData.turretLevel) {\n        //                     treasureId = item.id;\n        //                     break;\n        //                 }\n        //             }\n        //             if (treasureId) {\n\n        //                 let checkId = (id) => {\n        //                     return id == treasureId;\n        //                 }\n        //                 let isExist: boolean = util.userData.haveTreasure.some(checkId);\n\n        //                 if (isExist) {\n        //                     return null;\n        //                 } else {                            \n        //                     if (this.nowId == treasureId) {\n        //                         return;\n        //                     }\n        \n        //                     this.nowId = treasureId;\n                            console.log(\"漂浮宝箱出现\")\n                            this.treasure.active = true;\n                            TrackMgr.airborne_treasure({\n                                activity_state: \"漂浮宝箱出现\"\n                            });\n        //                 }                       \n        //             }\n        //         }\n        //     },\n        //     onFail: err => {\n\n        //     }\n        // }\n        // )\n        \n        \n        // let id:number = util.checkTreasureShow();\n        // if(this.nowId==id){\n        //     return;\n        // }\n\n        // this.nowId = id;\n\n        // this.treasure.active = true;\n\n        // TrackMgr.airborne_treasure({\n        //     activity_state: \"漂浮宝箱出现\"\n        // });\n    }\n\n\n    /**点击宝箱 */\n    clickBtn() {\n        // if(util.userData.noviceGuide!==-1)return;\n        // this.treasure.active = false;\n\n        soundController.singleton.clickAudio();\n\n        this.showPage(pageTs.pageName.GameTreasure);\n        TrackMgr.airborne_treasure({\n            activity_state: \"打开漂浮宝箱\"\n        });\n    }\n\n\n    update (dt) {\n        if(this.time==null||this.treasureNum<=0)return;\n        this.time -=dt;\n        if(this.time<=0){\n            this.time = null;\n            this.flyAni();\n        }\n    }\n}\n"]}