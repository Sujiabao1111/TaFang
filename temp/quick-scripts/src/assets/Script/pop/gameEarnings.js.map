{"version":3,"sources":["assets\\Script\\pop\\gameEarnings.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { AssistCtr } from \"../Assist/AssistCtr\";\nimport baseTs from \"../base/baseTs\";\nimport { AdPosition } from \"../common/AdPosition\";\nimport NameTs from \"../common/NameTs\";\nimport { UrlConst } from \"../server/UrlConst\";\nimport AdController from \"../server/xmsdk_cocos/AD/AdController\";\nimport soundController from \"../soundController\";\nimport TrackMgr from \"../TrackMgr/TrackMgr\";\nimport tool from \"../util/tool\";\nimport util from \"../util/util\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class gameEarnings extends baseTs {\n\n    @property({ type: cc.Node, displayName: \"layout盒子\" })\n    private layoutNode: cc.Node = null;\n\n    @property({ type: cc.Label, displayName: \"时间\" })\n    private timeLabel: cc.Label = null;\n\n    @property({ type: [cc.Node], displayName: \"状态盒子\" })\n    private stateArr: cc.Node[] = [];\n\n    @property({ type: cc.Node, displayName: \"信息流\" })\n    private feed_node: cc.Node = null;\n\n    // onLoad () {}\n\n    private data: any;\n\n    private time: number = 0;\n\n    //当前第几个\n    private no: number = -1;\n\n    //类型\n    popupState: number;\n\n    init() {\n\n        util.post({\n            url: UrlConst.doubleEarn,\n            success: (res) => {\n                if(!this.isValid){\n                    return;\n                }\n                this.getState(res);\n            }\n        });\n\n\n        // let json =  {\n        //     leftTime: 0,\n        //     list:[\n        //         {incomeNodeName: \"30s\", incomeNodeId: 30, incomeNodeTime: \"30\"},\n        //         {incomeNodeName: \"100s\", incomeNodeId: 100, incomeNodeTime: \"100\"},\n        //         {incomeNodeName: \"150s\", incomeNodeId: 150, incomeNodeTime: \"150\"},\n        //         {incomeNodeName: \"200s\", incomeNodeId: 200, incomeNodeTime: \"200\"},\n        //         {incomeNodeName: \"300s\", incomeNodeId: 300, incomeNodeTime: \"300\"}\n        //     ],\n        //     nowLitNode: -1,\n        //     popupState: 1\n        // }\n        // this.getState(json);\n\n        /**加载双倍收益视频 */\n        // if (!util.adPreObj[AdPosition.Earning]) {\n        //     util.preloadAd(AdPosition.Earning);\n        // }\n    }\n\n    start() {\n\n    }\n\n    /**\n     * 设置状态\n     * @param data 数据\n     */\n    getState(data) {\n\n        this.data = data;\n\n        if (data && data.list && this.layoutNode && this.layoutNode.children) {\n            this.layoutNode.children.forEach((item, index) => {                \n                let dataItem = data.list[index];\n                //查找第几个\n                if (dataItem && data.nowLitNode == dataItem.incomeNodeId && data.nowLitNode !== -1) {\n                    this.no = index;\n                }\n                console.log(dataItem.incomeNodeId <= data.nowLitNode, 'dataItem.incomeNodeId<=data.nowLitNode')\n                if (item) {\n                    //改变颜色\n                    item.children[0].active = dataItem.incomeNodeId <= data.nowLitNode;\n                    //改变颜色\n                    if (dataItem.incomeNodeId <= data.nowLitNode) {\n                        if (dataItem.incomeNodeId == data.nowLitNode && data.popupState == 1) {\n                            item.children[1].opacity = 255;\n                        } else {\n                            item.children[1].opacity = 102;\n                        }\n                    }\n                    //修改节点label文字\n                    item.children[1].children[0].getComponent(cc.Label).string = dataItem.incomeNodeName;\n                    if (index > 0 && dataItem.incomeNodeId <= data.nowLitNode) {\n                        item.children[2].active = true;\n                    }\n                }\n            })\n        }\n        //转化为s\n        this.time = Math.floor(data.leftTime / 1000);\n        console.log(data.popupState, 'data.popupState', this.no)\n        this.setState(data.popupState);\n    }\n\n    /**开启倒计时 */\n    openDJS() {\n        this.schedule(() => {\n            this.time -= 1;\n            if (this.time <= 0) {\n                this.time = 0;\n                this.no += 1;\n                if (this.no >= this.data.list.length) {\n                    this.data.popupState = 2;\n                    this.data.incomeNodeId = this.data.list[this.data.list.length - 1].incomeNodeId;\n                } else {\n                    this.data.popupState = 0;\n                    this.data.incomeNodeId = this.data.list[this.no];\n                }\n                this.getState(this.data);\n                this.unscheduleAllCallbacks();\n            }\n            this.timeLabel.string = tool.changeTime(this.time);\n        }, 1);\n    }\n\n\n    /**\n     * 状态 未加速-0，加速中-1，加速次数已用完-2\n     * @param type \n     */\n    setState(type: number) {\n        this.stateArr[0].active =\n            this.stateArr[1].active =\n            this.stateArr[2].active = false;\n        let text: string = null;\n        this.popupState = type;\n        switch (type) {\n            case 0:\n                TrackMgr.double_revenue({\n                    activity_state: \"未加速\",\n                    today_times: this.data.list.length - this.no - 1\n                });\n\n                TrackMgr.AppBuyProductDialog_hcdg({\n                    dialog_name_hcdg: \"收益翻倍弹窗（未加速状态）\"\n                })\n\n                break;\n            case 1:\n                TrackMgr.AppBuyProductDialog_hcdg({\n                    dialog_name_hcdg: \"收益翻倍弹窗（加速中）\"\n                })\n                cc.game.emit(NameTs.Game_Earnings_Linster, this.time);\n                this.openDJS();\n                break;\n            case 2:\n                TrackMgr.AppBuyProductDialog_hcdg({\n                    dialog_name_hcdg: \"收益翻倍弹窗（次数用完）\"\n                })\n\n                text = \"次数已用完\";\n                TrackMgr.double_revenue({\n                    activity_state: \"未次数已用完加速\",\n                });\n                break;\n        }\n\n        this.stateArr[type].active = true;\n\n    }\n\n    /**\n     * 关闭页面\n     */\n    closeBtn() {\n        soundController.singleton.clickAudio();\n        this.closePage();\n\n        let text = null;\n        switch (this.popupState) {\n            case 0:\n                text = \"收益翻倍弹窗（未加速状态）\";\n\n                break;\n            case 1:\n                text = \"收益翻倍弹窗（加速中）\";\n                break;\n            case 2:\n                text = \"收益翻倍弹窗（次数用完）\";\n                break;\n        }\n\n        TrackMgr.AppDialogClick_hcdg({\n            dialog_name_hcdg: text,\n            ck_module: \"关闭\",\n        })\n    }\n\n    /**\n     * 开启\n     */\n    openBtn() {\n        soundController.singleton.clickAudio();\n        if(!this.data)return;\n        if (this.data.popupState == 2) {\n            AssistCtr.showToastTip(\"加速次数已用完\");\n            return;\n        }\n\n        AdController.loadAd(AdPosition.Earning, () => {\n            // util.preloadAd(AdPosition.Earning);\n            util.post({\n                url: UrlConst.activateEarn,\n                success: (res) => {\n                    AssistCtr.showToastTip(\"加速成功\");\n                    this.no += 1;\n                    util.doubleEarn.use = true;\n                    let time: number = Number(this.data.list[this.no].incomeNodeTime);\n                    util.doubleEarn.time = time;\n                    this.data.incomeNodeId = time;\n                    this.data.leftTime = time * 1000;\n                    this.data.popupState = 1;\n                    this.data.nowLitNode = time;\n                    this.getState(this.data);\n                    TrackMgr.double_revenue({\n                        activity_state: \"加速中\",\n                        acceleration_time: time + \"s\"\n                    });\n\n                    TrackMgr.AppDialogClick_hcdg({\n                        dialog_name_hcdg: \"收益翻倍弹窗（未加速状态）\",\n                        ck_module: \"免费领取\",\n                        active_ad_hcdg:\"激励视频\"\n                    })\n                },\n                fail: () => {\n                    AssistCtr.showToastTip(\"加速失败\");\n                }\n            })\n        }, () => {\n            AssistCtr.showToastTip(\"加载视频失败，请稍后！\");\n        });\n    }\n\n    onEnable() {\n        AdController.loadInfoAd(AdPosition.EarningView, 636, this.feed_node);//636:feedNode信息流容器节点的宽度\n    }\n\n\n    onDisable() {\n        AdController.hideInfoAd(AdPosition.EarningView);\n    }\n\n\n    // update (dt) {}\n}\n"]}