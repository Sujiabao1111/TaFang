{"version":3,"sources":["assets\\Script\\server\\xmsdk_cocos\\Utils\\LoadObject.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { Configs } from \"./XMLoad\";\n\nexport class LoadObject {\n    loadNode: cc.Node = null;\n    text: string;\n    retryLoadBgCount: number = 0;\n\n    private bgSpriteFrame: cc.SpriteFrame = null;\n\n    constructor(_text: string) {\n        this.text = _text;\n    }\n\n    public show(): void {\n        //加载背景纹理\n        if (this.bgSpriteFrame == null) {\n            this.loadBg();\n            return;\n        }\n\n        var canvas = cc.director.getScene().getComponentInChildren(cc.Canvas);\n        var width = canvas.node.width;\n        var height = canvas.node.height;\n\n        // load\n        let loadNode = new cc.Node();\n        loadNode.zIndex = 10000;\n        \n        // 添加一个widget组件, 铺满全屏\n        let widget = loadNode.addComponent(cc.Widget);\n        widget.alignMode = cc.Widget.AlignMode.ALWAYS;\n        widget.isAlignTop = true;\n        widget.isAlignBottom = true;\n        widget.isAlignLeft= true;\n        widget.isAlignRight = true;\n        widget.top = 0;\n        widget.bottom = 0;\n        widget.left = 0;\n        widget.right = 0;\n        // 添加一个防穿透\n        loadNode.addComponent(cc.BlockInputEvents);\n\n        // 添加一个load内容层\n        let loadWrap = new cc.Node();\n        // 添加一个load内容层精灵背景\n        let bgSprite = loadWrap.addComponent(cc.Sprite);\n        bgSprite.type = cc.Sprite.Type.SLICED;\n        bgSprite.sizeMode = cc.Sprite.SizeMode.CUSTOM;\n        bgSprite.node.opacity = 200;\n\n        // 添加一个load的icon\n        let loadIcon = new cc.Node();\n        let loadSprite = loadIcon.addComponent(cc.Sprite);\n        loadSprite.type = cc.Sprite.Type.SIMPLE;\n        loadSprite.sizeMode = cc.Sprite.SizeMode.TRIMMED;\n        cc.loader.load(\"http://imgs.gmilesquan.com/task-center1127/loading.png\", function (err, ret) {\n            if (err) {\n                console.info(\"loadIcon加载失败\", err);\n                \n            } else {\n                loadSprite.getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(ret);\n\n                if (!this.text) {\n                    loadWrap.width = ret.width + Configs.PADDING * 2;\n                }\n\n                // 给load的icon加一个360°的转动\n                let rotateAction = cc.repeatForever(\n                    cc.sequence(cc.rotateBy(1, 360), cc.callFunc(function () {\n                        loadIcon.angle = 0;\n                    }, this))\n                );\n\n                loadIcon.runAction(rotateAction);\n            }\n            \n            // 等icon加到load内容层，再来设置load内容层精灵背景，防止视觉上的感差\n            if (this.bgSpriteFrame) {\n                bgSprite.getComponent(cc.Sprite).spriteFrame = this.bgSpriteFrame;\n            }\n            \n        }.bind(this));\n\n        // 添加一个Layout，自动撑开load内容层\n        let bgLayout = loadWrap.addComponent(cc.Layout);\n        bgLayout.resizeMode = cc.Layout.ResizeMode.CONTAINER;\n        bgLayout.type = cc.Layout.Type.VERTICAL;\n        bgLayout.padding = Configs.PADDING;\n\n        // 把load的icon加到load内容层\n        loadWrap.addChild(loadIcon);\n\n        // 如果有提示语才建立Label，加入到load内容层\n        if (this.text) {\n            loadWrap.width = Configs.WIDTH;\n            bgLayout.spacingY = Configs.PADDING;\n            // 添加一个Label，用于load提示\n            let textNode = new cc.Node();\n            let textLabel = textNode.addComponent(cc.Label);\n            // Label文字设置\n            textLabel.horizontalAlign = cc.Label.HorizontalAlign.CENTER;\n            textLabel.verticalAlign = cc.Label.VerticalAlign.CENTER;\n            textLabel.fontSize = Configs.FONT_SIZE;\n            textLabel.lineHeight = Configs.LINE_HIGHT;\n            textLabel.string = this.text;\n            //文本过长时，设置为自动换行\n            if (this.text.length * textLabel.fontSize > (Configs.WIDTH - Configs.PADDING * 2)) {\n                textNode.width = (Configs.WIDTH - Configs.PADDING * 2);\n                textLabel.overflow = cc.Label.Overflow.RESIZE_HEIGHT;\n            }\n\n            loadWrap.addChild(textNode);\n        }\n\n        this.loadNode = loadNode;\n        loadNode.addChild(loadWrap);\n        canvas.node.addChild(loadNode);\n    }\n\n    public hide(): void {\n        if (this.loadNode) {\n            this.loadNode.destroy();\n        }\n    }\n\n    private loadBg(): void {\n        if(this.retryLoadBgCount >= 3){\n            this.bgSpriteFrame = new cc.SpriteFrame();\n            this.show();\n            return\n        }\n        cc.loader.loadRes(\"Toast/bgSprite\", function (err, ret) {\n            if (err) {\n                this.retryLoadBgCount ++;\n                console.info(\"bgSprite加载失败\", err);\n            } else {\n                this.bgSpriteFrame = new cc.SpriteFrame(ret);\n                this.bgSpriteFrame.insetTop = 24;\n                this.bgSpriteFrame.insetBottom = 24;\n                this.bgSpriteFrame.insetLeft = 40;\n                this.bgSpriteFrame.insetRight = 40;\n            }\n                \n            //加载完成再调用\n            this.show();\n        }.bind(this));\n    }\n}"]}