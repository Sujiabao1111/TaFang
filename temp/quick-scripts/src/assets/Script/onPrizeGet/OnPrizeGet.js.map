{"version":3,"sources":["assets\\Script\\onPrizeGet\\OnPrizeGet.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { AssistCtr } from \"../Assist/AssistCtr\";\r\nimport NameTs from \"../common/NameTs\";\r\nimport pageTs from \"../common/pageTs\";\r\nimport RedController from \"../controlelr/RedController\";\r\nimport { UrlConst } from \"../server/UrlConst\";\r\nimport XMSDK from \"../server/xmsdk_cocos/XMSDK\";\r\nimport TrackMgr from \"../TrackMgr/TrackMgr\";\r\nimport util from \"../util/util\";\r\n\r\nexport interface onPrizeData {\r\n    onPrizeRedData: Array<onPrizeRedItemData>           //全部红包全部信息\r\n}\r\n\r\nexport interface onPrizeRedItemData {\r\n    state: number,           //0.未领取  1.已领取\r\n    amount: number,          //红包金额\r\n    doubleAmount: number     //翻倍后红包金额\r\n    waitTime: number,        //需要等待的总时间 (秒)\r\n}\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class OnPrizeGet extends cc.Component {\r\n\r\n    //在线奖励\r\n    @property(cc.Node)\r\n    private btn_onPrizeGet: cc.Node = null;\r\n\r\n    @property(cc.SpriteFrame)\r\n    private btnSprFrame: Array<cc.SpriteFrame> = [];\r\n\r\n    @property(cc.Node)\r\n    private timeNode: cc.Node = null;\r\n\r\n    @property(cc.Node)\r\n    private redLayout: cc.Node = null;\r\n\r\n    @property(cc.Label)\r\n    private lable_time: cc.Label = null;\r\n\r\n    @property(cc.SpriteFrame)\r\n    private redSprArray: Array<cc.SpriteFrame> = [];\r\n\r\n    @property(cc.Node)\r\n    private img_rect: cc.Node = null;\r\n\r\n\r\n    private onPrizeData: onPrizeData = null;\r\n    private curOnPrizeRedData: onPrizeRedItemData = null;\r\n\r\n    private timeNum: number = 0;\r\n\r\n    private maxRectNum: number = 0; //进度条最大宽度\r\n    private getRedNum: number = 0; //红包数(未领取+已领取)\r\n    private onceTimer = 0;      //下一个红包所需要时间(秒)\r\n    private curTime = 0;        //当前时间\r\n\r\n    onLoad() {\r\n        this.maxRectNum = this.img_rect.parent.width;\r\n\r\n        cc.game.on(NameTs.onPrizeGetUpdate, this.updateData, this);\r\n    }\r\n\r\n    onEnable() {\r\n        this.updateData();\r\n    }\r\n\r\n    onDisable() {\r\n\r\n    }\r\n\r\n    updateData() {\r\n        XMSDK.getdataStr({\r\n            url: UrlConst.onPrizeGetRewardMain,\r\n            onSuccess: res => {\r\n                if(!this.isValid){\r\n                    return;\r\n                }\r\n\r\n                if (res.code === 0 && res.data) {\r\n                    this.curTime = util.onlineTimeNum;\r\n                    this.onPrizeData = res.data;\r\n\r\n                    RedController.onPrizeData = this.onPrizeData;\r\n\r\n                    this.init();\r\n                } else {\r\n                    XMSDK.toast(res.message || '网络出错~', 2.5, 1);\r\n                }\r\n            },\r\n            onFail: res => {\r\n\r\n            }\r\n        })\r\n    }\r\n\r\n    init() {\r\n        let self = this;\r\n        if (self && self.redLayout) {\r\n            let onPrizeData: onPrizeData = this.onPrizeData;\r\n            let redChild = self.redLayout.children;\r\n            let allRedData = onPrizeData.onPrizeRedData;\r\n            let isHaveGet = false;  //是否有可领取的红包\r\n            let isWait = false;     //是否要等待\r\n            let getRedNum = 0;      //红包数(未领取+已领取)\r\n            let onceTimer = 0;      //下一个红包所需要时间(秒)\r\n            let nextRedTime = 0;                //领取下一个红包剩余时间 (秒)\r\n            for (let i = 0; i < allRedData.length; i++) {\r\n                if (allRedData[i] && redChild[i]) {\r\n                    redChild[i].active = true;\r\n\r\n                    let redData: onPrizeRedItemData = allRedData[i];\r\n                    let targetNode = redChild[i];\r\n                    targetNode.getChildByName(\"lable_money\").getComponent(cc.Label).string = redData.amount + \"\";\r\n                    targetNode.getChildByName(\"guangNode\").active = false;\r\n                    if (redData.waitTime >= this.curTime && redData.state == 0) {\r\n                        targetNode.getChildByName(\"lable_getTip\").getComponent(cc.Label).string = `${redData.waitTime / 60}分钟`;\r\n                        if (!onceTimer) {\r\n                            isWait = true;\r\n                            nextRedTime = redData.waitTime - this.curTime;\r\n                            onceTimer = redData.waitTime;\r\n                        }\r\n                        targetNode.getChildByName(\"img_state\").getComponent(cc.Sprite).spriteFrame = self.redSprArray[0];\r\n                    }\r\n                    else if (redData.state == 0) {\r\n                        targetNode.getChildByName(\"img_state\").getComponent(cc.Sprite).spriteFrame = self.redSprArray[2];\r\n                        targetNode.getChildByName(\"lable_getTip\").getComponent(cc.Label).string = `可领`;\r\n                        if (!isHaveGet) {\r\n                            if (targetNode.getChildByName(\"guangNode\") && targetNode.getChildByName(\"guangNode\").getChildByName(\"saoguang\")) {\r\n                                let saoGuang: cc.Node = targetNode.getChildByName(\"guangNode\").getChildByName(\"saoguang\");\r\n                                saoGuang.stopAllActions();\r\n                                saoGuang.x = -100;\r\n                                targetNode.getChildByName(\"guangNode\").active = true;\r\n                                cc.tween(saoGuang).repeatForever(\r\n                                    cc.tween().to(0.64, { x: 100 }).delay(0.64).call(() => { saoGuang.x = -100 })\r\n                                ).start();\r\n                                this.curOnPrizeRedData = redData;\r\n                            }\r\n                        }\r\n\r\n                        isHaveGet = true;\r\n                        getRedNum++;\r\n                    }\r\n                    else if (redData.state == 1) {\r\n                        targetNode.getChildByName(\"img_state\").getComponent(cc.Sprite).spriteFrame = self.redSprArray[1];\r\n                        targetNode.getChildByName(\"lable_getTip\").getComponent(cc.Label).string = `已领取`;\r\n                        getRedNum++;\r\n                    }\r\n                }\r\n                else if (redChild[i]) {\r\n                    redChild[i].active = false;\r\n                }\r\n            }\r\n            self.btn_onPrizeGet.stopAllActions();\r\n            self.btn_onPrizeGet.scale = 1;\r\n            self.timeNum = nextRedTime;\r\n\r\n            if (isHaveGet) {\r\n                let tempColor = new cc.Color();\r\n                self.btn_onPrizeGet.active = true;\r\n                self.timeNode.active = false;\r\n                self.btn_onPrizeGet.getComponent(cc.Sprite).spriteFrame = self.btnSprFrame[0];\r\n                self.btn_onPrizeGet.getChildByName(\"lable_btn\").getComponent(cc.Label).string = `领取`;\r\n                self.btn_onPrizeGet.getChildByName(\"lable_btn\").getComponent(cc.LabelOutline).color = tempColor.fromHEX(\"#507900\");\r\n                cc.tween(self.btn_onPrizeGet).repeatForever(\r\n                    cc.tween().to(.4, { scale: 1.2 }).to(.4, { scale: 1 })\r\n                ).start();\r\n            }\r\n            else if (isWait && nextRedTime) {\r\n                self.btn_onPrizeGet.active = false;\r\n                self.openTimer();\r\n            }\r\n            else {\r\n                let tempColor = new cc.Color();\r\n                self.btn_onPrizeGet.active = true;\r\n                self.btn_onPrizeGet.getComponent(cc.Sprite).spriteFrame = self.btnSprFrame[1];\r\n                self.btn_onPrizeGet.getChildByName(\"lable_btn\").getComponent(cc.Label).string = `明日再来`;\r\n                self.btn_onPrizeGet.getChildByName(\"lable_btn\").getComponent(cc.LabelOutline).color = tempColor.fromHEX(\"#838383\");\r\n            }\r\n            self.getRedNum = getRedNum;\r\n            self.onceTimer = onceTimer;\r\n\r\n            self.updateRec();\r\n        }\r\n    }\r\n\r\n    openTimer() {\r\n        let self = this;\r\n        self.timeNode.active = true;\r\n        if (self.timeNum > 0) {\r\n            self.lable_time.string = AssistCtr.formatSeconds(self.timeNum);\r\n            self.schedule(self.timeFun, 1);\r\n        }\r\n    }\r\n\r\n    timeFun() {\r\n        let self = this;\r\n        if (self.timeNum > 0) {\r\n            self.lable_time.string = AssistCtr.formatSeconds(self.timeNum);\r\n            self.updateRec()\r\n        }\r\n        else {\r\n            self.unschedule(self.timeFun);\r\n            self.timeNum = 0;\r\n            self.updateData();\r\n        }\r\n        self.timeNum--;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param getRedNum 红包数(未领取+已领取)\r\n     * @param rab 距离下一个红包所需时间百分比     \r\n     */\r\n    updateRec() {\r\n        let self = this;\r\n        let getRedNum = self.getRedNum;\r\n        let pad = self.maxRectNum / 3;\r\n        let rab = 0;\r\n        if (self.onceTimer) {\r\n            rab = (self.onceTimer - self.timeNum) / self.onceTimer;\r\n        }\r\n\r\n        let addWidth = (getRedNum - 1) * pad + rab * pad;\r\n        if (addWidth > self.maxRectNum) {\r\n            addWidth = self.maxRectNum;\r\n        }\r\n        else if (!addWidth || addWidth < 0) {\r\n            addWidth = 0;\r\n        }\r\n        self.img_rect.width = addWidth;\r\n    }\r\n\r\n    clickGet() {\r\n        let self = this;\r\n        let str = self.btn_onPrizeGet.getChildByName(\"lable_btn\").getComponent(cc.Label).string;\r\n        if (str == \"明日再来\") {\r\n            AssistCtr.showToastTip(\"请明日再来\")\r\n        }\r\n        else if (str == \"领取\" && this.curOnPrizeRedData) {\r\n            cc.game.emit(NameTs.Game_Pop_Open, {\r\n                name: pageTs.pageName.GameOnPrizeGetReward,\r\n                data: {\r\n                    prizeRedData: this.curOnPrizeRedData\r\n                },\r\n            },this);\r\n        }\r\n\r\n        if (this.curOnPrizeRedData) {\r\n            TrackMgr.Online_rewards({\r\n                activity_state: \"点击主按钮\",\r\n                reward_state: `${this.curOnPrizeRedData.waitTime / 60}分钟`,\r\n                button_name_hcdg: str\r\n            })\r\n        }\r\n    }\r\n}\r\n"]}