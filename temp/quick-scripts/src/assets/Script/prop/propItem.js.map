{"version":3,"sources":["assets\\Script\\prop\\propItem.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { AssistCtr } from \"../Assist/AssistCtr\";\nimport baseTs from \"../base/baseTs\";\nimport { AdPosition } from \"../common/AdPosition\";\nimport { propProperty, propType } from \"../common/faceTs\";\nimport NameTs from \"../common/NameTs\";\nimport pageTs from \"../common/pageTs\";\nimport { UrlConst } from \"../server/UrlConst\";\nimport AdController from \"../server/xmsdk_cocos/AD/AdController\";\nimport XMSDK from \"../server/xmsdk_cocos/XMSDK\";\nimport soundController from \"../soundController\";\nimport TrackMgr from \"../TrackMgr/TrackMgr\";\nimport tool from \"../util/tool\";\nimport util from \"../util/util\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class propItem extends baseTs {\n\n    @property({ type: cc.Label, displayName: \"名字\" })\n    private nameLabel: cc.Label = null;\n\n    @property({ type: cc.Label, displayName: \"说明\" })\n    private explainLabel: cc.Label = null;\n\n    @property({ type: cc.Label, displayName: \"持续时间\" })\n    private timeLabel: cc.Label = null;\n\n    @property({ type: cc.Label, displayName: \"数量\" })\n    private numLabel: cc.Label = null;\n\n    @property({ type: cc.Sprite, displayName: \"图片\" })\n    private pic: cc.Sprite = null;\n\n    @property({ type: cc.Label, displayName: \"等级\" })\n    private levelLabel: cc.Label = null;\n\n    @property({ type: cc.Node, displayName: \"限制盒子\" })\n    private astrictBox: cc.Node = null;\n\n    @property({ type: cc.Node, displayName: \"增加\" })\n    private addIcon: cc.Node = null;\n\n    private initData;\n\n    //道具数量\n    private propNum: number = 0;\n    //是否被限制\n    private isAstrict: boolean;\n\n    //列表id\n    private id: number;\n    //道具id\n    private propId: number;\n\n    onLoad() {\n        cc.game.on(NameTs.Game_PropItem_Update, this.setData, this);\n        cc.game.on(NameTs.Game_Start, this.updateData, this);\n    }\n\n    start() {\n\n    }\n\n    updateData() {\n        if (this.initData) {\n            this.init(this.initData);\n        }\n    }\n\n    /**\n     * 初始化\n     * @param data 数据\n     */\n    init(data) {\n\n        this.initData = data;\n\n        this.id = this.initData.id;\n\n        this.nameLabel.string = this.initData.configName;\n\n        // if(this.initData.propIssueDetailList[0].propsId==propType.auto){\n        //     this.node.active = false;\n        // }\n\n\n        if(this.isAstrict && (util.userData.customs.big >= this.initData.propIssueDetailList[0].level)){\n            TrackMgr.AppBuyProductDialog_hcdg({\n                dialog_name_hcdg:\"恭喜解锁新道具\"\n            });\n            \n            TrackMgr.AppDialogClick_hcdg({\n                dialog_name_hcdg: \"恭喜解锁新道具\",\n                ck_module:\"收下\",\n            })\n        }\n\n        this.isAstrict = util.userData.customs.big < this.initData.propIssueDetailList[0].level;\n        this.propId = this.initData.propIssueDetailList[0].propsId;\n\n        if (this.initData.time > 0) {\n            this.timeLabel.string = this.initData.time + \"s\";\n        } else {\n            this.timeLabel.node.active = false;\n        }\n\n        this.explainLabel.string = this.initData.explain;\n\n        this.loadAny(\"texture/prop/prop\" + this.propId, cc.SpriteFrame, res => {\n\n            this.pic.spriteFrame = res;\n\n        });\n\n\n        this.astrictBox.active = this.isAstrict;\n\n        if (this.isAstrict) {\n            this.pic.node.color = cc.color(148, 148, 148, 255);\n            this.numLabel.node.getParent().active = this.addIcon.active = false;\n            this.levelLabel.string = \"炮塔\" + this.initData.level + \"级\\n解锁\"\n        }\n        else {\n            this.pic.node.color = cc.color(255, 255, 255, 255);\n        }\n\n        this.setData();\n\n    }\n\n    /**\n     * 使用\n     */\n    UseBtn() {\n        let data = tool.GetArrData(\"type\", this.propId, util.propConfig);\n        if(data && data.name != \"\"){\n            TrackMgr.AppClick({\n                app_page_title: \"首页\",\n                app_ck_module: `道具-${data.name}`,\n                app_exposure_type: \"banner\",\n            })\n        }\n\n\n        if (this.isAstrict) {\n            if (this.initData && this.initData.propIssueDetailList[0] && this.initData.propIssueDetailList[0].level) {\n                AssistCtr.showToastTip(`${this.initData.propIssueDetailList[0].level}关解锁`);\n            }\n            else {\n                AssistCtr.showToastTip(\"限制道具,还未到等级\");\n            }\n            soundController.singleton.playMusic(NameTs.clickNoAllowed);\n            return;\n        }\n        soundController.singleton.clickAudio();\n\n        if (this.propNum <= 0) {\n            \n\n            TrackMgr.AppBuyProductDialog_hcdg({\n                dialog_name_hcdg:\"未获得该道具\"\n            })\n            TrackMgr.AppDialogClick_hcdg({\n                dialog_name_hcdg: \"未获得该道具\",\n                ck_module:\"领取\",\n            })\n            cc.game.emit(NameTs.Game_Pop_Open, {\n                name: pageTs.pageName.GameToolGet,\n                data: {\n                    id: this.id,\n                    propId: this.propId,       \n                    node: this.node\n                }\n            });\n            util.props_number++;\n            XMSDK.trackUserProperties({\n                props_number: util.props_number,\n            });\n            return;\n        }\n        util.post({\n            url: UrlConst.useProp,\n            data: { propId: this.propId },\n            success: () => {\n\n            },\n            fail: () => {\n                this.sendMTrack(false, false);\n            }\n        });\n\n        util.UseProp(this.propId);\n        this.setData();\n        console.log(\"使用道具\", this.propId);\n        this.sendMTrack(true, false);\n        util.gamePropNum += 1;\n        \n    }\n\n    /**是否 */\n    sendMTrack(isSuccess: boolean, isVideo: boolean) {\n\n        let data = tool.GetArrData(\"type\", this.propId, util.propConfig);\n\n        TrackMgr.tool_used({\n            tool_name: data.name,\n            use_success: isSuccess,\n            is_video_tool: isVideo,\n            level: \"第\" + util.userData.customs.big + \"关\",\n        })\n\n    }\n\n    /**设置一下道具数量 */\n    setData() {\n\n        this.propNum = util.GetPropNum(this.propId);\n        \n        this.numLabel.node.getParent().active = this.propNum > 0;\n\n        this.addIcon.active = this.propNum == 0;\n\n        this.numLabel.string = this.propNum + \"\";\n        \n        // this.node.width = this.propNum == 0?0:80;\n    }\n\n    \n\n    // update (dt) {}\n}\n"]}